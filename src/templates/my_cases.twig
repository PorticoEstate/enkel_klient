{# filepath: /home/hc483/public_html/enkel_klient/src/templates/my_cases.twig #}
{% extends 'head.twig' %}

{% block body %}
	<div class="container mt-4">
		<h1 class="mb-4">Mine saker</h1>

		<div class="card mb-4">
			<div class="card-body">
				<h5 class="card-title">Brukerinformasjon</h5>
				<p class="card-text">Navn:
					{{ user_name }}</p>
				{% if user_email %}
					<p class="card-text">E-post:
						{{ user_email }}</p>
				{% endif %}
			</div>
		</div>

		{% if result and result.results and result.results|length > 0 %}
			<div class="table-responsive">
				<table class="table table-striped table-hover">
					<thead class="table-light">
						<tr>
							{# Sortable ID column #}
							<th scope="col">
								<a href="{{ base_path }}/my_cases?sort=id&sort=id&dir={{ result.sort == 'id' and result.dir == 'asc' ? 'desc' : 'asc' }}&start={{ result.start }}" class="text-decoration-none text-dark">
									#
									{% if result.sort == 'id' %}
										<i class="fas fa-sort-{{ result.dir == 'asc' ? 'up' : 'down' }} ms-1"></i>
									{% else %}
										<i class="fas fa-sort text-muted ms-1"></i>
									{% endif %}
								</a>
							</th>

							{# Sortable Registration Date column #}
							<th scope="col">
								<a href="{{ base_path }}/my_cases?sort=entry_date&sort=entry_date&dir={{ result.sort == 'entry_date' and result.dir == 'asc' ? 'desc' : 'asc' }}&start={{ result.start }}" class="text-decoration-none text-dark">
									Registrert dato
									{% if result.sort == 'entry_date' %}
										<i class="fas fa-sort-{{ result.dir == 'asc' ? 'up' : 'down' }} ms-1"></i>
									{% else %}
										<i class="fas fa-sort text-muted ms-1"></i>
									{% endif %}
								</a>
							</th>

							{# Non-sortable Subject column #}
							<th scope="col">Emne</th>

							{# Sortable Last Updated column #}
							<th scope="col">
								<a href="{{ base_path }}/my_cases?sort=modified_date&sort=modified_date&dir={{ result.sort == 'modified_date' and result.dir == 'asc' ? 'desc' : 'asc' }}&start={{ result.start }}" class="text-decoration-none text-dark">
									Sist oppdatert
									{% if result.sort == 'modified_date' %}
										<i class="fas fa-sort-{{ result.dir == 'asc' ? 'up' : 'down' }} ms-1"></i>
									{% else %}
										<i class="fas fa-sort text-muted ms-1"></i>
									{% endif %}
								</a>
							</th>

							{# Non-sortable columns #}
							<th scope="col">Status</th>
							<th scope="col">Handling</th>
						</tr>
					</thead>
					<tbody>
						{% for case in result.results %}
							<tr>
								<td>{{ case.id }}</td>
								<td>
									{% if case.registered_date is defined %}
										{{ case.registered_date|date('d.m.Y H:i') }}
									{% elseif case.entry_date is defined %}
										{{ case.entry_date|date('d.m.Y H:i') }}
									{% else %}
										-
									{% endif %}
								</td>
								<td>{{ case.subject }}</td>
								<td>
									{% if case.status_change_date is defined %}
										{{ case.status_change_date|date('d.m.Y H:i') }}
									{% elseif case.modified_date is defined %}
										{{ case.modified_date|date('d.m.Y H:i') }}
									{% else %}
										-
									{% endif %}
								</td>
								<td>
									{% if case.status == 'O' %}
										<span class="badge bg-success">{{case.status_text}}</span>
									{% elseif case.status == 'C1' %}
										<span class="badge bg-warning text-dark">{{case.status_text}}</span>

									{% elseif case.status == 'X' %}
										<span class="badge bg-secondary">{{case.status_text}}</span>

									{% elseif case.status == 'C' %}
										<span class="badge bg-secondary">{{case.status_text}}</span>

									{% else %}
										<span class="badge bg-info">{{ case.status_text }}</span>

									{% endif %}
								</td>
								<td>
									<a href="{{ base_path }}/view_case/{{ case.id }}" class="btn btn-sm btn-outline-primary">
										<i class="fas fa-eye"></i>
										Se detaljer
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>

			<div class="mt-3 d-flex justify-content-between">
				<p class="text-muted">
					<small>Viser
						{{ result.start + 1 }}
						-
						{{ result.start + result.results|length }}
						av totalt
						{{ result.total_records }}
						saker</small>
				</p>

				{% if result.total_records > result.results|length %}
					<nav aria-label="Page navigation">
						<ul class="pagination pagination-sm">
							{% if result.start > 0 %}
								<li class="page-item">
									<a class="page-link" href="{{ base_path }}/my_cases?start=0&sort={{ result.sort }}&sort={{ result.sort }}&dir={{ result.dir }}" aria-label="First">
										<span aria-hidden="true">&laquo;&laquo;</span>
									</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="{{ base_path }}/my_cases?start={{ result.start - result.perPage }}&sort={{ result.sort }}&sort={{ result.sort }}&dir={{ result.dir }}" aria-label="Previous">
										<span aria-hidden="true">&laquo;</span>
									</a>
								</li>
							{% endif %}

							{% if result.start + result.results|length < result.total_records %}
								<li class="page-item">
									<a class="page-link" href="{{ base_path }}/my_cases?start={{ result.start + result.perPage }}&sort={{ result.sort }}&sort={{ result.sort }}&dir={{ result.dir }}" aria-label="Next">
										<span aria-hidden="true">&raquo;</span>
									</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="{{ base_path }}/my_cases?start={{ result.total_records - result.perPage }}&sort={{ result.sort }}&sort={{ result.sort }}&dir={{ result.dir }}" aria-label="Last">
										<span aria-hidden="true">&raquo;&raquo;</span>
									</a>
								</li>
							{% endif %}
						</ul>
					</nav>
				{% endif %}
			</div>
		{% else %}
			<div class="alert alert-info">
				<p>Du har ingen registrerte saker enn√•.</p>
			</div>
		{% endif %}

		<div class="mt-4">
			<h2 class="h4 mb-3">Opprett ny sak</h2>
			<div class="row">
				{% if config.services.helpdesk %}
					<div class="col-md-6 mb-3">
						<div class="d-grid">
							<a href="{{ base_path }}/helpdesk" class="btn btn-outline-primary">
								<i class="fas fa-ticket-alt me-2"></i>
								{{ config.helpdesk.form_header }}
							</a>
						</div>
					</div>
				{% endif %}

				{% if config.services.nokkelbestilling %}
					<div class="col-md-6 mb-3">
						<div class="d-grid">
							<a href="{{ base_path }}/nokkelbestilling" class="btn btn-outline-primary">
								<i class="fas fa-key me-2"></i>
								{{ config.nokkelbestilling.form_header }}
							</a>
						</div>
					</div>
				{% endif %}

			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () { // Make table rows clickable but exclude header row and clicks on buttons/links
const rows = document.querySelectorAll('tbody tr');
rows.forEach(row => {
row.addEventListener('click', function (e) {
if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'A' && ! e.target.closest('a') && ! e.target.closest('button')) {
const link = this.querySelector('a.btn-outline-primary');
if (link) {
link.click();
}
}
});
row.style.cursor = 'pointer';
});
});
	</script>
{% endblock %}
